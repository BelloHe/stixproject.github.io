---
layout: idiom
title: Malware Used During an Incident
---

It's often useful to identify the pieces of malware that are used to carry out an incident. This can help understand what the impact is, shape courses of action, and help others understand how to avoid similar incidents.

## Scenario

The scenario we'll work with describes an incident in which the PIVY Remote Access Trojan was used to gain remote access. The scenario is specifically focused on representing malware so no other information about the incident will be represented.

## Data model

<img src="diagram.png" alt="Malware used during an incident" class="aside-text" />

This idiom is represented as a relationship between the [Incident](/documentation/incident/IncidentType) component and the [TTP](/documentation/ttp/TTPType) component. The incident describes information specific to the incident itself while the TTP contains a description of the malware. The `Leveraged TTPs` relationship from the incident to the TTP is then used to indicate that the TTP was leveraged to carry out the incident.

#### Malware Description

This part of the idiom borrows heavily from the [simple malware representation idiom](/idioms/ttp/simple-malware). The TTP `Behavior` field contains, among other things, a list of malware instances that the TTP leverages. Each of those can either represent a simple malware name and type, as here, or a full [MAEC](http://maec.mitre.org) characterization. In this case, the scenario just requires a simple description.

The `Name` field in the malware instance is set to the name of the malware: "Poison Ivy". The `Type` field (a controlled vocabulary) is set to a value from the default vocabulary ([MalwareTypeVocab-1.0](/documentation/stixVocabs/MalwareTypeVocab-1.0)): "Remote Access Trojan". The `Title`, `Description`, and `Short Description` fields could also be used to describe the malware instance in more detail but in this case just the name and type are used.

#### Incident

Given the constrained scenario, the incident construct is also fairly limited: it contains a `Title` to identify the incident and a single `Leveraged TTP`. That TTP reference is related to the TTP defined above and the relationship is characterized as "Uses Malware" using the `Relationship` field within `Leveraged TTP`.

## XML

{% highlight xml linenos %}

{% endhighlight %}

[Full XML](sample.xml)

## Python
{% highlight python linenos %}
from stix.core import STIXPackage
from stix.incident import Incident
from stix.ttp import TTP, Behavior
from stix.common.related import RelatedTTP
from stix.ttp.malware_instance import MalwareInstance

malware = MalwareInstance()
malware.add_name("Poison Ivy")
malware.add_type("Remote Access Trojan")

ttp = TTP(title="Poison Ivy")
ttp.behavior = Behavior()
ttp.behavior.add_malware_instance(malware)

incident = Incident(title="Detected Poison Ivy beaconing through perimeter firewalls")
related_ttp = RelatedTTP(TTP(idref=ttp.id_), relationship="Uses Malware")
incident.leveraged_ttps.append(related_ttp)

stix_package = STIXPackage()
stix_package.add_ttp(ttp)
stix_package.add_incident(incident)

print stix_package.to_xml() 
{% endhighlight %}

[Full Python](incident-malware.py)

## Further Reading

See the full documentation for the relevant types for further information that may be provided:

* [IncidentType](/documentation/incident/IncidentType)